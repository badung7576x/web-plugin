<!DOCTYPE html>
<head>
    <title>Test</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
	<script>
        (function($){
            $.fn.extend({
                selectAddress: function(options) {

                    let datas = [];
                    let datas1 = [];
                    let datas2 = [];

                    let defaults = {
                        type : 'province'
                    };

                    var options = $.extend(defaults, options);


                    if(options.type === 'province') {
                        url = 'http://localhost:3000/api/v1/provinces'

                        $.ajax({
                            async: false,
                            url: url,
                            type: 'GET',
                            data: { 'request': "", 'target': 'arrange_url', 'method': 'method_target' },
                        }).done(function(response) {
                            datas = response;
                        });

                        $.ajax({
                            async: false,
                            url: 'http://localhost:3000/api/v1/districts/1',
                            type: 'GET',
                            data: { 'request': "", 'target': 'arrange_url', 'method': 'method_target' },
                        }).done(function(response) {
                            datas1 = response;
                        });

                        $.ajax({
                            async: false,
                            url: 'http://localhost:3000/api/v1/wards/1',
                            type: 'GET',
                            data: { 'request': "", 'target': 'arrange_url', 'method': 'method_target' },
                        }).done(function(response) {
                            datas2 = response;
                        });

                        return this.each(function() {
                            datas.forEach((item) => {
                                $(this).append("<option value=" + item._code + " data-id='"+ item.id +"'>" + (item._prefix ?? "")  + " " + item._name + "</option>");
                            });
                            datas1.forEach((item) => {
                                $('#district-select').append("<option value=" + item._code + " data-id='"+ item.id +"'>" + (item._prefix ?? "")  + " " + item._name + "</option>");
                            });
                            datas2.forEach((item) => {
                                $('#ward-select').append("<option value=" + item._code + " data-id='"+ item.id +"'>" + (item._prefix ?? "")  + " " + item._name + "</option>");
                            });
                        });
                    }

                    if(options.type === 'district') {
                        $('#province-select').change(function(){
                            parentId = $('#province-select').find('option:selected').data('id')
                            url = 'http://localhost:3000/api/v1/districts/' + parentId
                        }).change((res) => {

                            $.ajax({
                                async: false,
                                url: url,
                                type: 'GET',
                                data: { 'request': "", 'target': 'arrange_url', 'method': 'method_target' },
                            }).done(function(response) {
                                datas = response;
                            });

                            return this.each(function() {
                                $(this).find('option').remove().end();
                                datas.forEach((item) => {
                                    $(this).append("<option value=" + item._code + " data-id='"+ item.id +"'>" + (item._prefix ?? "")  + " " + item._name + "</option>");
                                });
                            });
                        })
                    }

                    if (options.type === 'ward') {
                        $('#province-select').change(function (){
                            districtId = $('#district-select').find('option:selected').data('id')
                            console.log('ffff',districtId)
                            url = 'http://localhost:3000/api/v1/wards/' + districtId
                        }).change(res => {
                            $.ajax({
                                async: false,
                                url: url,
                                type: 'GET',
                            }).done(function(response) {
                                datas = response;
                            });

                            return this.each(function() {
                                $(this).find('option').remove().end();
                                datas.forEach((item) => {
                                    $(this).append("<option value=" + item._code + " data-id='"+ item.id +"'>" + (item._prefix ?? "")  + " " + item._name + "</option>");
                                });
                            });
                        })

                        $('#district-select').change(function (){
                            districtId = $('#district-select').find('option:selected').data('id')
                            console.log('ffff',districtId)
                            url = 'http://localhost:3000/api/v1/wards/' + districtId
                        }).change(res => {
                            $.ajax({
                                async: false,
                                url: url,
                                type: 'GET',
                            }).done(function(response) {
                                datas = response;
                            });

                            return this.each(function() {
                                $(this).find('option').remove().end();
                                datas.forEach((item) => {
                                    $(this).append("<option value=" + item._code + " data-id='"+ item.id +"'>" + (item._prefix ?? "")  + " " + item._name + "</option>");
                                });
                            });
                        })
                    }
                }
            });
        })(jQuery);

	</script>

	<script type="text/javascript">
        $(document).ready(function() {
            $('#province-select').selectAddress();
            $('#district-select').selectAddress({type: 'district'});
            $('#ward-select').selectAddress({type: 'ward'});
        });
	</script>
</head>
<body>
    <select name="province" id="province-select"></select>
    <select name="district" id="district-select"></select>
    <select name="ward" id="ward-select"></select>
</body>
</html>
